---
title: "Tuftish Book"
author: "John Smith"
date: "August 13th, 2014"
bibliography: "knitcitations.bib"
output: 
  tufte_book:
    latex_engine: lualatex
    toc: true
    toc_depth: 3
---

```{r setup,echo=FALSE,message=FALSE,cache=FALSE,include=TRUE}
# Its a good idea to start any rmarkdown document with a block like this one to set knit defaults, setup the bibliography, and so forth.
library(knitcitations)
library(knitr)
library(xtable)
library(ggplot2)
library(papeR)
cite_options(citation_format = "pandoc",
  					 cite.style= "authortitle",
						 style="citation",
						 hyperlink="to.doc",
						 check.entries=FALSE)

opts_chunk$set(   echo = FALSE,
  								warning=FALSE,
							 		error=TRUE,
									message=FALSE,
									tidy=TRUE,
									cache=TRUE,
							 		fig.keep = 'high',
							 		dev = "tikz",
							 		crop = TRUE,
							 		results='asis',
							 		comment=NA,
							 		sanitize=TRUE,
									highlight = TRUE,
									background='#C1CDCD',
                  externalize=TRUE,
                  concordance=TRUE
							 )
knit_hooks$set(crop = hook_pdfcrop)
options(xtable.comment = FALSE)
options(xtable.booktabs = TRUE)

# This is also a good place to setup any ggplot2 themes for the document using ggplot2::theme_set()

```

\clearpage

\openepigraph{Sometimes epigraphs look cool.}{-Apocryphal}

# Introduction

The Tufte-\LaTeX\ document classes define a style similar to the style Edward Tufte uses in his books and handouts. Tufteâ€™s style is known for its extensive use of sidenotes, tight integration of graphics with text, and well-set typography.[^tufte_latex]  

This "Tuftish" template is adapted from the Tufte-book class.  It has modifications intended to make it both more flexible and more consistent with expectations from **rmarkdown**.  Some of those modifications are inconsistent with Tufte's style, in that the template will allow you to make documents more visually complex than Tufte would probably advise. 


# Things that aren't quite working yet:

* luatex and xetex
  + This is important because tikzDevice with pdflatex can easily run out of memory
* subsubsections
* The TOC should have page numbers right-justified

\part{''The party of the first part''}

Books can have more than one Part.

\chapter{''A chapter about headings''}

And many chapters

# This is a section heading

This style provides a-, b- and d-heads (that is, `#`, `##` and `####`).

## This is a subsection heading

Isn't that pretty?

#### This is a paragraph heading

Not ugly

\newthought{In his later books}, Tufte starts each section with a bit of vertical space, a non-indented paragraph, and sets the first few words of the sentence in small caps. To accomplish this using this style, use the `\newthought` command as demonstrated at the beginning of this paragraph.[^books_be]

\chapter{''A chapter about figures, equations, and tables''}


# Figures

All of the figures in this book were made using the **tikzDevice** R package.  It automagically matches the font styles in the figure with those in the rest of the document.  The plots themselves tend to be slightly more elegant.  `CairoPDF` and, on Mac OS X, `QuartzPDF`, are good alterntives if you can't use tikz for some reason.  

## Margin Figures

Images and graphics play an integral role in Tufte's work. To place figures or tables in the margin you can use the `fig.margin` knitr chunk option. For example:

```{r, fig.margin = TRUE, fig.cap = "Sepal length vs. petal length, colored by species",dev='tikz'}
library(ggplot2)
qplot(Sepal.Length, Petal.Length, data = iris, color = Species)
```

Note the use of the `fig.cap` chunk option to provide a figure caption. You can adjust the proportions of figures using the `fig.width` and `fig.height` chunk options. These are specified in inches, and will be automatically scaled down to fit within the handout margin.

## Equations

You can also include \LaTeX\ equations in the margin by explicitly invoking the `marginfigure` environment.

\begin{marginfigure}
$$\frac{d}{dx}\left( \int_{0}^{x} f(u)\,du\right)=f(x).$$
\caption{An equation}
\end{marginfigure}

Note the use of the `\caption` command to add additional text below the equation.

## Full Width Figures

You can arrange for figures to span across the entire page by using the `fig.fullwidth` chunk option. 

```{r, fig.width = 10, fig.height = 2, fig.fullwidth = TRUE, fig.cap = "Full width figure",dev='tikz'}
qplot(wt, mpg, data=mtcars, colour=factor(cyl))
```

Note the use of the `fig.width` and `fig.height` chunk options to establish the proportions of the figure. Full width figures look much better if their height is minimized.

## Main Column Figures

Besides margin and full width figures, you can of course also include figures constrained to the main column.

```{r, fig.cap = "Another figure",dev='tikz'}
qplot(factor(cyl), mpg, data = mtcars, geom = "boxplot")
```

# Sidenotes

One of the most prominent and distinctive features of this style is the extensive use of sidenotes. There is a wide margin to provide ample room for sidenotes and small figures. Any use of a footnote will automatically be converted to a sidenote. ^[This is a sidenote that was entered using a footnote.] 

If you'd like to place ancillary information in the margin without the sidenote mark (the superscript number), you can use the `\marginnote` command. \marginnote{This is a margin note.  Notice that there isn't a number preceding the note.}

Note also that the two footnote references (`tufte_latex` and `books_be`, both defined below) were also included in the margin on the first page of this document.  Another way of doing things, which will be explained below, is to use a citation management package to keep track of citations.

# Tables

You can use the **xtable** package to format \LaTeX\ tables that integrate well with the rest of the Tufte handout style. Note that it's important to set the `xtable.comment` and `xtable.booktabs` options to ensure the table is formatted correctly for inclusion in the document.

```{r, results='asis'}
xtable(head(mtcars[,1:6]), caption = "First rows of mtcars")
```

## Margin Tables

You can also create margin tables using the **xtable** package together with the **kable** function in the **knitr** package.  Margin tables are extra-sensitive to errors - its probably best to create your tables in main text while drafting, and only move them to the margin at the end.

\begin{margintable}
```{r amargintable,results='latex'}
frm <- data.frame(a = c(1,2,3), b = c("a","b", "c"))
kable(xtable(table(frm)), format = "latex")
```
\caption{Margin tables captions are defined in latex, not in arguments to the table-making function}
\end{margintable}

## Pretty Tables

This is also a good time to point out the virtues of the **papeR** package for printing output from statistical functions.^[`r citep(citation("papeR"))`]

```{r papeRdemo}
fit <- lm(mpg ~ hp + wt, data = mtcars)
tab <- prettify(anova(fit))
xtable(tab)
```

\chapter{''A Chapter About Columns, Full Width Text, and Landscape Mode.''}

# Columns

Columns are sometimes useful.  There are many ways to make columns.  The one built into the Tufte-Book class is called `multicol`.^[`r citep("http://ctan.mirrorcatalogs.com/macros/latex/required/tools/multicol.pdf")`.  For other ways to make columns see http://wiki.contextgarden.net/Columns.]  

\begin{multicols}{2}

Some things don't work inside of columns, or other environments like margin notes and margin tables.  That's why the citations are in the main text and not in columns.  

\columnbreak

I could have made that first column of text flow into this one, but instead I used a column break.

\end{multicols}

\clearpage



\section{''Fullwidth and Landscape''}

\begin{fullwidth}

Its easy to get a portion of the text to use the full width of a page.  \LaTeX\ can be touchy though.  I couldn't use the `\#` markdown for the section heading above.  But it isn't hard to put in a section heading manually.

Anyway, fullwidth text can be useful when you have wide tables.

\clearpage


\begin{landscape}

Part of a document can also be in landscape.  This can also be useful for wide tables.

\end{landscape}
\end{fullwidth}


\clearpage

[^tufte_latex]: https://code.google.com/p/tufte-latex/
[^books_be]: http://www.edwardtufte.com/tufte/books_be

# Indices

You can insert lists of tables and figures in your document.

All of the indicies, bibliography, and footnotes get hyperlinked together automagically.  Try it!

\listoffigures

\listoftables

\clearpage

# Bibliography
 
Including a bibliography is a 3-step process.  *First*, using the **RefManageR** and **knitcitations** packages, liberally sprinkle your text with inline R calls to knitcitation's `citep()` or `citet()` functions.  `r citep(citation("knitcitations"))`; `r citep(citation("RefManageR"))`.  *Second*, at the end of your document, include an R block that calls the function  `write.bibtex()`.  `r write.bibtex(file="knitcitations.bib", append=FALSE,biblatex=TRUE)`  That will write a bibtex file containing your citations to disk.  *Third*, in the yaml header, include a `bibliography` line pointing to the `.bib` file produced by `write.bibtex()`.

Use the `\vspace` command to insert blank verticle spaces. 

\vspace{10mm}







